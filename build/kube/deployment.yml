apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: boxboat-blog-prod
spec:
  replicas: 1
  template:
    metadata:
      labels:
        app: boxboat-blog-prod
    spec:
      containers:
      - name: nginx
        imagePullPolicy: Always
        image: gcr.io/caleb-lloyd/boxboat-blog-nginx:1
        env:
        - name: DEVENV
          value: prod
        ports:
        - containerPort: 80
      - name: dotnet
        imagePullPolicy: Always
        image: gcr.io/caleb-lloyd/boxboat-blog-dotnet:1
        env:
        - name: DEVENV
          value: prod
        ports:
        - containerPort: 5000
        volumeMounts:
        - name: boxboat-blog-db
          mountPath: /etc/secrets/boxboat-blog-db
          readOnly: true
      - name: ui-ssr
        imagePullPolicy: Always
        image: gcr.io/caleb-lloyd/boxboat-blog-ui-ssr:1
        env:
        - name: DEVENV
          value: prod
        ports:
        - containerPort: 4000
      volumes:
      - name: boxboat-blog-db
        secret:
          secretName: boxboat-blog-db
